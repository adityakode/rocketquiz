<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rocket Quiz - Home</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        /* Leaderboard sliding menu style */
        #leaderboard {
            position: fixed;
            top: 0;
            left: -100%; /* Start off-screen */
            width: 300px;
            height: 100%;
            background-color: white;
            box-shadow: 2px 0 5px rgba(0, 0, 0, 0.3);
            transition: left 0.3s ease-in-out;
            z-index: 10;
        }
        #leaderboard.open {
            left: 0; /* Slide in */
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">
    <div class="container mx-auto px-4">
        <h1 class="text-4xl font-bold text-center mb-8">Rocket Quiz</h1>

        <!-- Leaderboard Button (Top Left) -->
        <button id="leaderboardBtn" class="absolute top-4 left-4 bg-blue-500 text-white px-4 py-2 rounded">
            Leaderboard
        </button>

        <!-- Leaderboard Sliding Menu -->
        <div id="leaderboard" class="bg-white shadow-lg p-4">
            <h2 class="text-xl font-semibold">Leaderboard</h2>
            <div id="leaderboardContent" class="mt-2 grid grid-cols-1 gap-4">
                <!-- Leaderboard data will be displayed here -->
                <p>Loading...</p>
            </div>
            <button id="hideLeaderboard" class="mt-4 bg-red-500 text-white px-4 py-2 rounded">
                &lt; Hide
            </button>
        </div>

        <!-- Avatar Selection and Name Input -->
        <div class="flex flex-col items-center">
            <div class="relative w-full max-w-xs">
                <button id="avatarDropdown" class="bg-gray-200 border rounded w-full flex items-center justify-between p-2">
                    <img id="selectedAvatarImg" src="https://rocketquizbucket.s3.eu-north-1.amazonaws.com/space_cats.jpg" alt="Space Cats" class="w-12 h-12 inline-block mr-2">
                    <span id="selectedAvatar">Space Cats</span>
                    <span>&#9662;</span> <!-- Dropdown arrow -->
                </button>
                <div id="avatarOptions" class="absolute left-0 z-10 w-full bg-white border mt-1 rounded hidden">
                    <div class="p-2 cursor-pointer flex items-center" data-avatar="Space Cats" data-img="https://rocketquizbucket.s3.eu-north-1.amazonaws.com/space_cats.jpg">
                        <img src="https://rocketquizbucket.s3.eu-north-1.amazonaws.com/space_cats.jpg" alt="Space Cats" class="w-12 h-12 inline-block mr-2"> Space Cats
                    </div>
                    <div class="p-2 cursor-pointer flex items-center" data-avatar="Rusty Racoon" data-img="https://rocketquizbucket.s3.eu-north-1.amazonaws.com/rusty_racoon.jpg">
                        <img src="https://rocketquizbucket.s3.eu-north-1.amazonaws.com/rusty_racoon.jpg" alt="Rusty Racoon" class="w-12 h-12 inline-block mr-2"> Rusty Racoon
                    </div>
                    <div class="p-2 cursor-pointer flex items-center" data-avatar="Ninja Shepherd" data-img="https://rocketquizbucket.s3.eu-north-1.amazonaws.com/ninja_shepherd.jpg">
                        <img src="https://rocketquizbucket.s3.eu-north-1.amazonaws.com/ninja_shepherd.jpg" alt="Ninja Shepherd" class="w-12 h-12 inline-block mr-2"> Ninja Shepherd
                    </div>
                    <div class="p-2 cursor-pointer flex items-center" data-avatar="Cyber Monkey" data-img="https://rocketquizbucket.s3.eu-north-1.amazonaws.com/cyber_monkey.jpg">
                        <img src="https://rocketquizbucket.s3.eu-north-1.amazonaws.com/cyber_monkey.jpg" alt="Cyber Monkey" class="w-12 h-12 inline-block mr-2"> Cyber Monkey
                    </div>
                    <div class="p-2 cursor-pointer flex items-center" data-avatar="Funky Giraffe" data-img="https://rocketquizbucket.s3.eu-north-1.amazonaws.com/funky_giraffe.jpg">
                        <img src="https://rocketquizbucket.s3.eu-north-1.amazonaws.com/funky_giraffe.jpg" alt="Funky Giraffe" class="w-12 h-12 inline-block mr-2"> Funky Giraffe
                    </div>
                </div>
            </div>

            <input type="text" id="userName" placeholder="Enter your name" class="mt-4 p-2 border rounded w-full max-w-xs" required>
            <button id="startQuiz" class="mt-4 bg-green-500 text-white px-4 py-2 rounded">
                Start
            </button>
        </div>
    </div>

    <script>
        $(document).ready(function() {
            // Toggle leaderboard sliding menu
            $('#leaderboardBtn').click(function() {
                $('#leaderboard').toggleClass('open');
                if ($('#leaderboard').hasClass('open')) {
                    fetchLeaderboard();
                }
            });

            // Hide leaderboard
            $('#hideLeaderboard').click(function() {
                $('#leaderboard').removeClass('open');
            });

            // Toggle avatar dropdown
            $('#avatarDropdown').click(function() {
                $('#avatarOptions').toggle();
            });

            // Select avatar
            $('#avatarOptions .p-2').click(function() {
                const avatarName = $(this).data('avatar');
                const avatarImg = $(this).data('img');
                $('#selectedAvatar').text(avatarName);
                $('#selectedAvatarImg').attr('src', avatarImg);
                $('#avatarOptions').hide();
            });

            // Start quiz button action
            $('#startQuiz').click(function() {
                const selectedAvatar = $('#selectedAvatar').text();
                const userName = $('#userName').val();

                if (selectedAvatar === "Select Avatar" || userName === "") {
                    alert("Please select an avatar and enter your name.");
                    return;
                }

                // Redirect to the quiz page and pass the name and avatar as query parameters
                window.location.href = `quiz.html?username=${encodeURIComponent(userName)}&avatar=${encodeURIComponent(selectedAvatar)}`;
            });
        });

        // Function to fetch leaderboard data from the backend
        function fetchLeaderboard() {
            fetch('http://13.61.8.98:3000/api/leaderboard')
                .then(response => {
                    if (!response.ok) throw new Error('Network response was not ok');
                    return response.json();
                })
                .then(data => {
                    const leaderboardContent = $('#leaderboardContent');
                    leaderboardContent.empty(); // Clear previous content
                    if (data.length === 0) {
                        leaderboardContent.append('<p>No scores available.</p>');
                    } else {
                        data.forEach(entry => {
                            leaderboardContent.append(`
                                <div class="bg-gray-100 p-4 rounded-lg shadow flex items-center">
                                    <img src="${entry.avatar}" alt="${entry.username}'s Avatar" class="w-16 h-16 rounded-full mr-4">
                                    <div>
                                        <h3 class="text-lg font-bold">${entry.username}</h3>
                                        <p class="text-gray-600">${entry.score} points</p>
                                    </div>
                                </div>
                            `);
                        });
                    }
                })
                .catch(error => {
                    console.error('Error fetching leaderboard:', error);
                    $('#leaderboardContent').html('<p>Error loading leaderboard.</p>');
                });
        }
    </script>
</body>
</html>
